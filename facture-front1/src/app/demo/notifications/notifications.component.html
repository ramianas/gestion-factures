<!-- Fichier: facture-front1/src/app/demo/notifications/notifications.component.html -->

<div class="notifications-container">
  <!-- État de chargement -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement des notifications...</span>
      </div>
      <p class="mt-3">Chargement de vos notifications...</p>
    </div>
  </div>

  <!-- Contenu principal -->
  <div *ngIf="!isLoading" class="main-content">
    <!-- En-tête avec statistiques -->
    <div class="page-header">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2 class="page-title">
            <i class="fas fa-bell me-2"></i>
            Mes Notifications
          </h2>
          <p class="page-subtitle">Gérez toutes vos notifications en un seul endroit</p>
        </div>
        <div class="header-actions">
          <button type="button" class="btn btn-outline-primary me-2" (click)="markAllAsRead()">
            <i class="fas fa-check-double me-1"></i>
            Marquer toutes comme lues
          </button>
          <button type="button" class="btn btn-primary">
            <i class="fas fa-cog me-1"></i>
            Paramètres
          </button>
        </div>
      </div>
    </div>

    <!-- Statistiques -->
    <div class="stats-section mb-4">
      <div class="row">
        <div class="col-md-3">
          <app-card [showHeader]="false" blockClass="stats-card">
            <div class="stat-item">
              <div class="stat-icon bg-primary">
                <i class="fas fa-bell"></i>
              </div>
              <div class="stat-content">
                <h4>{{ stats.total }}</h4>
                <p>Total</p>
              </div>
            </div>
          </app-card>
        </div>
        <div class="col-md-3">
          <app-card [showHeader]="false" blockClass="stats-card">
            <div class="stat-item">
              <div class="stat-icon bg-warning">
                <i class="fas fa-exclamation-circle"></i>
              </div>
              <div class="stat-content">
                <h4>{{ stats.unread }}</h4>
                <p>Non lues</p>
              </div>
            </div>
          </app-card>
        </div>
        <div class="col-md-3">
          <app-card [showHeader]="false" blockClass="stats-card">
            <div class="stat-item">
              <div class="stat-icon bg-danger">
                <i class="fas fa-fire"></i>
              </div>
              <div class="stat-content">
                <h4>{{ stats.urgent }}</h4>
                <p>Urgentes</p>
              </div>
            </div>
          </app-card>
        </div>
        <div class="col-md-3">
          <app-card [showHeader]="false" blockClass="stats-card">
            <div class="stat-item">
              <div class="stat-icon bg-info">
                <i class="fas fa-arrow-up"></i>
              </div>
              <div class="stat-content">
                <h4>{{ stats.high }}</h4>
                <p>Priorité élevée</p>
              </div>
            </div>
          </app-card>
        </div>
      </div>
    </div>

    <!-- Filtres -->
    <div class="filters-section">
      <app-card cardTitle="Filtres" [showContent]="true">
        <ng-template #headerTitleTemplate>
          <i class="fas fa-filter me-2"></i>
        </ng-template>

        <div class="row align-items-center">
          <div class="col-md-8">
            <div class="filter-buttons">
              <button
                type="button"
                class="btn"
                [ngClass]="selectedFilter === 'ALL' ? 'btn-primary' : 'btn-outline-primary'"
                (click)="applyFilter('ALL')">
                Toutes
              </button>
              <button
                type="button"
                class="btn ms-2"
                [ngClass]="selectedFilter === 'SUCCESS' ? 'btn-success' : 'btn-outline-success'"
                (click)="applyFilter('SUCCESS')">
                <i class="fas fa-check-circle me-1"></i>
                Succès
              </button>
              <button
                type="button"
                class="btn ms-2"
                [ngClass]="selectedFilter === 'WARNING' ? 'btn-warning' : 'btn-outline-warning'"
                (click)="applyFilter('WARNING')">
                <i class="fas fa-exclamation-triangle me-1"></i>
                Attention
              </button>
              <button
                type="button"
                class="btn ms-2"
                [ngClass]="selectedFilter === 'ERROR' ? 'btn-danger' : 'btn-outline-danger'"
                (click)="applyFilter('ERROR')">
                <i class="fas fa-times-circle me-1"></i>
                Erreurs
              </button>
              <button
                type="button"
                class="btn ms-2"
                [ngClass]="selectedFilter === 'INFO' ? 'btn-info' : 'btn-outline-info'"
                (click)="applyFilter('INFO')">
                <i class="fas fa-info-circle me-1"></i>
                Info
              </button>
            </div>
          </div>
          <div class="col-md-4 text-end">
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="unreadFilter"
                [(ngModel)]="showOnlyUnread"
                (change)="toggleUnreadFilter()">
              <label class="form-check-label" for="unreadFilter">
                Afficher seulement les non lues
              </label>
            </div>
          </div>
        </div>
      </app-card>
    </div>

    <!-- Liste des notifications -->
    <div class="notifications-list">
      <app-card cardTitle="Notifications ({{ filteredNotifications.length }})" [showContent]="true">
        <ng-template #headerTitleTemplate>
          <i class="fas fa-list me-2"></i>
        </ng-template>

        <!-- Aucune notification -->
        <div *ngIf="filteredNotifications.length === 0" class="empty-state">
          <div class="text-center py-5">
            <i class="fas fa-bell-slash fa-3x text-muted mb-3"></i>
            <h4>Aucune notification</h4>
            <p class="text-muted">
              {{ selectedFilter !== 'ALL' || showOnlyUnread ? 'Aucune notification ne correspond à vos critères.' : 'Vous n\'avez aucune notification pour le moment.' }}
            </p>
          </div>
        </div>

        <!-- Liste des notifications -->
        <div *ngIf="filteredNotifications.length > 0" class="notifications-items">
          <div
            *ngFor="let notification of filteredNotifications; trackBy: trackByNotificationId"
            class="notification-item"
            [ngClass]="{ 'unread': !notification.isRead }"
            (click)="navigateToAction(notification)">

            <div class="notification-content">
              <!-- Icône et badge de priorité -->
              <div class="notification-icon">
                <i [class]="notification.icon + ' ' + notification.iconColor"></i>
                <span *ngIf="notification.priority === 'URGENT' || notification.priority === 'HIGH'"
                      [class]="getPriorityBadgeClass(notification.priority)"
                      class="priority-badge">
                  {{ getPriorityLabel(notification.priority) }}
                </span>
              </div>

              <!-- Contenu principal -->
              <div class="notification-body">
                <div class="notification-header">
                  <h6 class="notification-title">{{ notification.title }}</h6>
                  <span class="notification-type badge bg-light text-dark">
                    {{ getTypeLabel(notification.type) }}
                  </span>
                </div>

                <p class="notification-message">{{ notification.message }}</p>

                <div class="notification-footer">
                  <small class="notification-time text-muted">
                    <i class="fas fa-clock me-1"></i>
                    {{ getRelativeTime(notification.dateCreation) }}
                  </small>

                  <!-- Métadonnées spécifiques -->
                  <div *ngIf="notification.metadata" class="notification-metadata">
                    <span *ngIf="notification.metadata.factureId" class="badge bg-secondary">
                      {{ notification.metadata.factureId }}
                    </span>
                    <span *ngIf="notification.metadata.statut" class="badge bg-info">
                      {{ notification.metadata.statut }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Actions -->
              <div class="notification-actions">
                <div class="dropdown">
                  <button
                    class="btn btn-sm btn-outline-secondary dropdown-toggle"
                    type="button"
                    data-bs-toggle="dropdown">
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="#" (click)="markAsRead(notification); $event.preventDefault()">
                        <i class="fas fa-check me-2"></i>
                        {{ notification.isRead ? 'Marquer comme non lue' : 'Marquer comme lue' }}
                      </a>
                    </li>
                    <li *ngIf="notification.actionUrl">
                      <a class="dropdown-item" href="#" (click)="navigateToAction(notification); $event.preventDefault()">
                        <i class="fas fa-external-link-alt me-2"></i>
                        Voir le détail
                      </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <a class="dropdown-item text-danger" href="#" (click)="deleteNotification(notification.id); $event.preventDefault()">
                        <i class="fas fa-trash me-2"></i>
                        Supprimer
                      </a>
                    </li>
                  </ul>
                </div>

                <!-- Indicateur non lu -->
                <div *ngIf="!notification.isRead" class="unread-indicator">
                  <span class="badge bg-primary rounded-pill">●</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </app-card>
    </div>
  </div>
</div>
